<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>â™¬ç©ç®—é›»å“ V24 - 13æœŸãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ç‰ˆ</title>
<style>
:root { --bg: #1a1a1a; --card: #2d2d2d; --text: #e0e0e0; --accent: #4caf50; --danger: #f44336; }
body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
.container { width: 100%; max-width: 500px; }
.header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.rank-display { background: var(--accent); color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold; cursor: pointer; }
.card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
.grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
button { border: none; border-radius: 8px; padding: 12px 5px; font-size: 14px; font-weight: bold; cursor: pointer; transition: 0.2s; position: relative; }
.btn-calc { background: #444; color: white; }
.btn-calc:active { transform: scale(0.95); background: #555; }
.btn-calc .count { position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; display: flex; align-items: center; justify-content: center; border: 2px solid var(--card); }
.btn-calc .sub { display: block; font-size: 10px; font-weight: normal; color: #bbb; margin-top: 2px; }
.result-area { font-size: 24px; font-weight: bold; text-align: center; color: var(--accent); margin: 10px 0; border-top: 1px solid #444; padding-top: 10px; }
.free-input-group { display: flex; gap: 5px; margin-bottom: 8px; }
.free-input-group input { flex: 1; background: #333; border: 1px solid #555; color: white; padding: 10px; border-radius: 8px; font-size: 16px; }
.modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:1000; }
.modal-content { background:var(--card); width:90%; max-width:400px; border-radius:15px; padding:20px; max-height:80vh; overflow-y:auto; }
.config-row { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 5px; margin-bottom: 10px; }
.config-row input { background:#333; border:1px solid #555; color:white; padding:5px; border-radius:4px; width:100%; box-sizing:border-box; }
.btn-main { background: var(--accent); color: white; width: 100%; padding: 12px; border-radius: 8px; margin-top: 10px; font-size: 16px; }
.btn-outline { background: transparent; border: 1px solid #666; color: #ccc; width: 100%; padding: 8px; border-radius: 8px; margin-top: 10px; }
.summary-list { font-size: 14px; color: #bbb; margin-top: 10px; line-height: 1.6; }
.summary-item { display: flex; justify-content: space-between; border-bottom: 1px dotted #444; }
</style>
</head>
<body>

<div class="container">
<div class="header">
<div style="font-size: 18px; font-weight: bold;">â™¬ç©ç®—é›»å“ <span style="font-size: 12px; color: var(--accent);">V24</span></div>
<div id="rankBtn" class="rank-display">ãƒ©ãƒ³ã‚¯: S</div>
</div>

<div class="card">
<div class="grid" id="buttonGrid"></div>
</div>

<div class="card">
<div style="font-size: 12px; color: #888; margin-bottom: 8px;">è‡ªç”±å…¥åŠ›ï¼ˆé‡‘é¡Ã—æ›ã‘ç‡ï¼‰</div>
<div id="freeInputArea"></div>
</div>

<div class="card">
<div class="result-area" id="totalDisplay">åˆè¨ˆ: Â¥0</div>
<div id="summaryArea" class="summary-list"></div>
<button class="btn-outline" onclick="resetAll()">å…¨ãƒªã‚»ãƒƒãƒˆ</button>
<button class="btn-outline" id="openSettings">âš™ è¨­å®šãƒ»ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</button>
<button class="btn-outline" onclick="openHayami()">ğŸ“‹ æ±ç”¨æ—©è¦‹è¡¨ã‚’é–‹ã</button>
</div>
</div>

<div id="modal" class="modal">
<div class="modal-content">
<h3 style="margin-top:0">âš™ è¨­å®š</h3>
<label style="font-size:12px">æ¶ˆè²»ç¨ç‡ (%)</label>
<input id="taxInput" type="number" style="width:100%; background:#333; color:white; border:1px solid #555; padding:8px; border-radius:5px; margin-bottom:15px;">

<label style="font-size:12px">ç«¯æ•°å‡¦ç†</label>
<select id="roundSelect" style="width:100%; background:#333; color:white; border:1px solid #555; padding:8px; border-radius:5px; margin-bottom:15px;">
<option value="round">å››æ¨äº”å…¥</option>
<option value="floor">åˆ‡ã‚Šæ¨ã¦</option>
<option value="ceil">åˆ‡ã‚Šä¸Šã’</option>
</select>

<div style="display:grid; grid-template-columns: 2fr 1fr 1fr; gap:5px; font-size:10px; color:#888; margin-bottom:5px;">
<div>ãƒœã‚¿ãƒ³å</div><div>å ±é…¬å˜ä¾¡</div><div>è«‹æ±‚å˜ä¾¡(ãƒ¡ãƒ¢)</div>
</div>
<div id="buttonConfigArea"></div>

<h4 style="border-bottom:1px solid #444; padding-bottom:5px;">è‡ªç”±å…¥åŠ›ãƒœã‚¿ãƒ³è¨­å®š</h4>
<div id="freeConfigArea"></div>

<button class="btn-main" id="saveBtn">è¨­å®šã‚’ä¿å­˜</button>
<button class="btn-outline" id="downloadHtml">æœ€æ–°HTMLã‚’ç”Ÿæˆ</button>
<button class="btn-outline" id="backupJson">è¨­å®šã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—(JSON)</button>
<button class="btn-outline" style="color:var(--danger); border-color:var(--danger);" onclick="fullReset()">åˆæœŸçŠ¶æ…‹ã«ãƒªã‚»ãƒƒãƒˆ</button>
<button class="btn-outline" onclick="closeModal()">é–‰ã˜ã‚‹</button>
</div>
</div>

<script>
// --- åˆæœŸãƒ‡ãƒ¼ã‚¿ ---
const MASTER_TABLE = {
14000: { S: 10309, A: 9794, B: 9278, C: 8763, D: 8247, E: 7732, F: 7216, G: 6701, H: 6185 },
16000: { S: 11782, A: 11193, B: 10604, C: 10015, D: 9425, E: 8836, F: 8247, G: 7658, H: 7069 },
17500: { S: 12886, A: 12242, B: 11598, C: 10953, D: 10309, E: 9665, F: 9020, G: 8376, H: 7732 },
19500: { S: 14359, A: 13641, B: 12923, C: 12205, D: 11487, E: 10769, F: 10051, G: 9333, H: 8615 },
"NICHITO": { S: 19636, A: 19636, B: 19636, C: 18655, D: 17673, E: 16691, F: 15709, G: 14727, H: 13745 }
};

const INITIAL_CONFIG = {
taxRate: 10,
roundMethod: "round",
rank: "S",
buttons: [
{name:"å®šæœŸUP", custPrice: 14000, fixedReward: 10309},
{name:"æ™®é€šUP", custPrice: 16000, fixedReward: 11782},
{name:"å®šæœŸGP", custPrice: 17500, fixedReward: 12886},
{name:"æ™®é€šGP", custPrice: 19500, fixedReward: 14359},
{name:"èª¿æ•´1", fixedReward: 1000, custPrice: null},
{name:"èª¿æ•´2", fixedReward: 2000, custPrice: null},
{name:"åŸºæœ¬å ±é…¬", fixedReward: 0, custPrice: null},
{name:"åŠ ç®—å ±é…¬", fixedReward: 0, custPrice: null},
{name:"éƒ¨å“ä»£1", fixedReward: 0, custPrice: null},
{name:"éƒ¨å“ä»£2", fixedReward: 0, custPrice: null},
{name:"è«¸çµŒè²»", fixedReward: 0, custPrice: null},
{name:"å‡ºå¼µè²»", fixedReward: 0, custPrice: null},
{name:"æŠ€è¡“æ–™", fixedReward: 0, custPrice: null},
{name:"ä»˜å¸¯ä½œæ¥­", fixedReward: 0, custPrice: null},
{name:"æŒè¾¼æ–™", fixedReward: 0, custPrice: null},
{name:"æ—¥å½“", custPrice: "NICHITO", fixedReward: 19636},
{name:"æœªç™»éŒ²1", fixedReward: 0, custPrice: null},
{name:"æœªç™»éŒ²2", fixedReward: 0, custPrice: null},
{name:"é™¤æ¹¿å‰¤", fixedReward: 655, custPrice: 1600},
{name:"éµç›¤äº¤æ›", fixedReward: 17183, custPrice: 25000}
],
freeButtons: [
{name:"è‡ªç”±1", coeff: 0.7364, value: ""},
{name:"è‡ªç”±2", coeff: 1.0, value: ""}
]
};

let cfg = JSON.parse(localStorage.getItem("reward_calc_config")) || INITIAL_CONFIG;
let counts = Array(cfg.buttons.length).fill(0);
let currentRank = cfg.rank || "S";

// --- è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ ---
function getReward(b) {
// 1. æ—¥å½“ï¼ˆNICHITOï¼‰ã¾ãŸã¯ ç‰¹å®šã®è«‹æ±‚é¡(14000ç­‰)ãŒã‚ã‚‹å ´åˆã®ã¿ã€ãƒ©ãƒ³ã‚¯åˆ¥ã«è‡ªå‹•è¨ˆç®—ã™ã‚‹
if (b.custPrice === "NICHITO") return MASTER_TABLE["NICHITO"][currentRank];
if (MASTER_TABLE[b.custPrice]) return MASTER_TABLE[b.custPrice][currentRank];

// 2. ãã‚Œä»¥å¤–ï¼ˆæœªç™»éŒ²ã‚„é™¤æ¹¿å‰¤ã€éµç›¤äº¤æ›ç­‰ï¼‰ã¯è¨­å®šç”»é¢ã®ã€Œå ±é…¬é¡ã€ã‚’å›ºå®šã§è¿”ã™
return b.fixedReward;
}

function calculateTotal() {
let subtotal = 0;
let summaryHtml = "";

// é€šå¸¸ãƒœã‚¿ãƒ³
cfg.buttons.forEach((b, i) => {
if (counts[i] > 0) {
const reward = getReward(b);
const amt = reward * counts[i];
subtotal += amt;
summaryHtml += `<div class="summary-item"><span>${b.name} (Â¥${reward.toLocaleString()} Ã— ${counts[i]})</span><span>Â¥${amt.toLocaleString()}</span></div>`;
}
});

// è‡ªç”±å…¥åŠ›
cfg.freeButtons.forEach((f) => {
const val = parseFloat(f.value) || 0;
if (val > 0) {
const amt = Math.round(val * f.coeff);
subtotal += amt;
summaryHtml += `<div class="summary-item"><span>${f.name} (Â¥${val.toLocaleString()} Ã— ${f.coeff})</span><span>Â¥${amt.toLocaleString()}</span></div>`;
}
});

const tax = Math.round(subtotal * (cfg.taxRate / 100));
const total = subtotal + tax;

document.getElementById("totalDisplay").innerText = `åˆè¨ˆ: Â¥${total.toLocaleString()}`;
document.getElementById("summaryArea").innerHTML = summaryHtml +
`<div class="summary-item" style="border-top:1px solid #666; margin-top:5px;"><span>ç¨æŠœåˆè¨ˆ</span><span>Â¥${subtotal.toLocaleString()}</span></div>` +
`<div class="summary-item"><span>æ¶ˆè²»ç¨ (${cfg.taxRate}%)</span><span>Â¥${tax.toLocaleString()}</span></div>`;
}

// --- UIæç”» ---
function render() {
const grid = document.getElementById("buttonGrid"); grid.innerHTML = "";
cfg.buttons.forEach((b, i) => {
const btn = document.createElement("button");
btn.className = "btn-calc";
const reward = getReward(b);
btn.innerHTML = `${b.name}<span class="sub">Â¥${reward.toLocaleString()}</span>`;
if (counts[i] > 0) {
const badge = document.createElement("span"); badge.className = "count"; badge.innerText = counts[i];
btn.appendChild(badge);
}
btn.onclick = () => { counts[i]++; calculateTotal(); render(); };
btn.oncontextmenu = (e) => { e.preventDefault(); if(counts[i]>0) counts[i]--; calculateTotal(); render(); };
grid.appendChild(btn);
});

const fArea = document.getElementById("freeInputArea"); fArea.innerHTML = "";
cfg.freeButtons.forEach((f, i) => {
const group = document.createElement("div"); group.className = "free-input-group";
group.innerHTML = `<input type="number" placeholder="${f.name}ã®é‡‘é¡" value="${f.value}" id="freeIn${i}">`;
group.oninput = (e) => { cfg.freeButtons[i].value = e.target.value; calculateTotal(); };
fArea.appendChild(group);
});

document.getElementById("rankBtn").innerText = `ãƒ©ãƒ³ã‚¯: ${currentRank}`;
}

// --- ã‚¤ãƒ™ãƒ³ãƒˆé–¢ä¿‚ ---
document.getElementById("rankBtn").onclick = () => {
const ranks = ["S","A","B","C","D","E","F","G","H"];
let idx = ranks.indexOf(currentRank);
currentRank = ranks[(idx + 1) % ranks.length];
cfg.rank = currentRank;
localStorage.setItem("reward_calc_config", JSON.stringify(cfg));
calculateTotal(); render();
};

document.getElementById("openSettings").onclick = () => {
document.getElementById("modal").style.display = "flex";
document.getElementById("taxInput").value = cfg.taxRate;
document.getElementById("roundSelect").value = cfg.roundMethod;

const bConfig = document.getElementById("buttonConfigArea"); bConfig.innerHTML = "";
cfg.buttons.forEach((b, i) => {
const div = document.createElement("div"); div.className = "config-row";
const rewVal = b.fixedReward;
const custDisp = (b.custPrice === 'NICHITO' ? 'NICHITO' : (b.custPrice || ''));
div.innerHTML = `
<input id="bn${i}" value="${b.name}">
<input id="br${i}" type="number" value="${rewVal}">
<input id="bc${i}" type="text" value="${custDisp}" placeholder="è«‹æ±‚é¡(ãƒ¡ãƒ¢)">
`;
bConfig.appendChild(div);
});

const fConfig = document.getElementById("freeConfigArea"); fConfig.innerHTML = "";
cfg.freeButtons.forEach((f, i) => {
const div = document.createElement("div"); div.className = "config-row";
div.innerHTML = `<input id="fn${i}" value="${f.name}"><input id="fc${i}" type="number" step="0.0001" value="${f.coeff}">`;
fConfig.appendChild(div);
});
};

document.getElementById("saveBtn").onclick = () => {
cfg.taxRate = parseFloat(document.getElementById("taxInput").value);
cfg.roundMethod = document.getElementById("roundSelect").value;
cfg.buttons.forEach((b, i) => {
b.name = document.getElementById(`bn${i}`).value;
b.fixedReward = Number(document.getElementById(`br${i}`).value);
let cp = document.getElementById(`bc${i}`).value;
if(cp === "") b.custPrice = null;
else if(cp === "NICHITO") b.custPrice = "NICHITO";
else b.custPrice = isNaN(Number(cp)) ? cp : Number(cp);
});
cfg.freeButtons.forEach((f, i) => {
f.name = document.getElementById(`fn${i}`).value;
f.coeff = parseFloat(document.getElementById(`fc${i}`).value);
});
localStorage.setItem("reward_calc_config", JSON.stringify(cfg));
alert("ä¿å­˜ã—ã¾ã—ãŸ");
location.reload();
};

function resetAll() { counts.fill(0); cfg.freeButtons.forEach(f => f.value = ""); calculateTotal(); render(); }
function closeModal() { document.getElementById("modal").style.display = "none"; }
function fullReset() { if(confirm("å…¨ã¦åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ")) { localStorage.removeItem("reward_calc_config"); location.reload(); } }

// ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
document.getElementById("downloadHtml").onclick = () => {
const htmlContent = document.documentElement.outerHTML;
const blob = new Blob([htmlContent], { type: "text/html" });
const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = "RewardCalc_V24.html"; a.click();
};
document.getElementById("backupJson").onclick = () => {
const blob = new Blob([JSON.stringify(cfg, null, 2)], { type: "application/json" });
const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = "reward_config.json"; a.click();
};

function openHayami() { window.open("https://github.com/T-Shigeta/hayami/blob/main/README.md", "_blank"); }

render();
calculateTotal();
</script>
</body>
</html>


